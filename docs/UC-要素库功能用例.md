# 要素库功能用例

> 本文档从 PRD-产品需求说明书.md 抽取，描述要素库模块的详细功能用例。

## 概述

要素是评估数据的最小采集单元，通过要素库进行统一管理。要素定义了数据的来源、类型和计算方式，是连接采集工具与指标体系的桥梁。

### 要素类型

| 类型 | 说明 | 数据来源 |
|------|------|----------|
| 基础要素 | 直接采集的数据项 | 关联采集工具的表单字段 |
| 派生要素 | 通过公式计算的数据项 | 基于其他要素计算（如：师生比 = 教师数 / 学生数） |
| 满意度要素 | 问卷满意度统计 | 关联问卷类型采集工具，按阈值计算满意率 |

### 要素属性

| 属性 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| 编码 (code) | string | ✓ | 要素唯一标识，如 `student_count` |
| 名称 (name) | string | ✓ | 要素显示名称，如"在校学生数" |
| 数据类型 | enum | ✓ | 文本、数字、日期、时间、逻辑、数组、文件 |
| 采集级别 | enum | ✓ | school（学校级）、district（区县级）、auto（自动判断） |
| 关联工具 | ref | 条件 | 基础要素必填，关联的采集工具ID |
| 关联字段 | ref | 条件 | 基础要素必填，关联的表单字段ID |
| 计算公式 | string | 条件 | 派生要素必填，计算公式表达式 |
| 聚合配置 | enum | | 多填报数据的汇总方式 |

### 聚合方式

| 聚合类型 | 说明 | 适用场景 |
|----------|------|----------|
| sum | 求和 | 人数、金额等累加值 |
| avg | 平均 | 平均分、平均值 |
| count | 计数 | 记录数量 |
| max | 最大值 | 最高分、最大值 |
| min | 最小值 | 最低分、最小值 |
| median | 中位数 | 中位数统计 |
| stddev | 标准差 | 离散程度分析 |
| range | 极差 | 最大-最小 |
| cv | 差异系数 | 均衡性分析 |

### 满意度要素属性（满意度要素专用）

| 属性 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| 关联问卷工具 | ref | ✓ | 问卷类型采集工具ID |
| 满意阈值 | number | ✓ | ≥此分数判定为"满意"（如 60） |
| 问卷满分 | number | ✓ | 问卷满分值（自动从问卷工具获取） |

### 满意度计算逻辑

```
单份问卷：问卷得分 ≥ 满意阈值 → 满意
满意率 = 满意问卷数 / 回收问卷总数 × 100%
```

*示例：*
- 要素名称：家长满意度
- 关联问卷：家长满意度调查问卷
- 问卷满分：100 分
- 满意阈值：60 分
- 回收 200 份，170 份得分 ≥ 60 → 满意率 = 85%

### 要素库状态

| 状态 | 说明 | 可执行操作 |
|------|------|------------|
| draft | 草稿 | 编辑、删除 |
| editing | 编辑中 | 编辑、发布 |
| published | 已发布 | 取消发布 |

### 与其他模块关系

- 要素 ←→ 采集工具字段映射：基础要素关联表单字段，实现数据采集
- 要素 ←→ 数据指标关联：要素为数据指标提供数据支撑
- 要素 ←→ 派生计算：派生要素引用其他要素进行计算

---

## 功能用例

---

### UC-ELEM-00: 查看要素库列表

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-00 |
| 用例名称 | 查看要素库列表 |
| 用例简述 | 系统管理员进入要素库页面，查看概况统计和要素库列表，支持按状态筛选和关键字搜索 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限 |
| 后置条件 | 无状态变更 |

**页面入口：**
- 左侧菜单：系统配置 → 要素库

**页面布局：**
```
┌─ 要素库概况 ────────────────────────────────────────────────────────────────┐
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐                    │
│  │ 要素库总数 │  │  已发布   │  │  编辑中   │  │  要素总数  │                    │
│  │    5     │  │    3     │  │    2     │  │    128   │                    │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘                    │
└───────────────────────────────────────────────────────────────────────────────┘

┌─ 要素库列表 ──────────────────────────────────────────────────────────────────┐
│  [全部状态 ▼]  [搜索要素库________________🔍]           [+ 创建要素库]        │
├───────────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────────────────┐   │
│ │ 义务教育基础数据要素库                                   要素数: 45  已发布│   │
│ │ 包含学校基本信息、师资配置、学生数据等基础采集要素                        │   │
│ │ 创建时间: 2025-01-10  创建人: admin  更新时间: 2025-01-15  更新人: admin │   │
│ │                                                                         │   │
│ │                           [◉ 基础信息] [📝 编辑要素] [取消发布]          │   │
│ └─────────────────────────────────────────────────────────────────────────┘   │
│ ┌─────────────────────────────────────────────────────────────────────────┐   │
│ │ 教育质量评估要素库                                      要素数: 32  编辑中│   │
│ │ 教育质量相关的评估指标数据要素                                            │   │
│ │ 创建时间: 2025-01-08  创建人: admin  更新时间: 2025-01-12  更新人: admin │   │
│ │                                                                         │   │
│ │                           [◉ 基础信息] [📝 编辑要素] [发布] [🗑️ 删除]   │   │
│ └─────────────────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────────────────────────┘
```

**概况统计卡片：**
| 统计项 | 说明 | 图标颜色 |
|--------|------|----------|
| 要素库总数 | 所有要素库数量 | 蓝色 |
| 已发布 | status='published' 的数量 | 绿色 |
| 编辑中 | status='editing' 的数量 | 橙色 |
| 要素总数 | 所有要素库中的要素数量总和 | 紫色 |

**列表筛选：**
| 筛选项 | 类型 | 选项 |
|--------|------|------|
| 状态筛选 | 下拉单选 | 全部状态 / 草稿 / 编辑中 / 已发布 |
| 关键字搜索 | 输入框 | 按名称模糊搜索 |

**列表项展示：**
| 信息 | 说明 |
|------|------|
| 名称 | 要素库名称，可点击查看详情 |
| 描述 | 要素库描述（可选，显示时截断） |
| 创建信息 | 创建时间、创建人 |
| 更新信息 | 更新时间、更新人 |
| 要素数 | 该库下的要素总数 |
| 状态 | 草稿（灰色）/ 编辑中（橙色）/ 已发布（绿色） |

**操作按钮（按状态显示）：**
| 状态 | 可用操作 |
|------|----------|
| 草稿 | 基础信息、编辑要素、发布、删除 |
| 编辑中 | 基础信息、编辑要素、发布、删除 |
| 已发布 | 基础信息、编辑要素、取消发布 |

**主流程：**
1. 进入要素库页面
2. 页面顶部显示概况统计（要素库总数、已发布、编辑中、要素总数）
3. 列表区域显示所有要素库，按更新时间倒序排列
4. 可通过状态下拉筛选（全部/草稿/编辑中/已发布）
5. 可通过搜索框按名称模糊搜索
6. 根据状态显示不同的操作按钮

**操作入口：**
| 操作 | 入口 | 跳转/弹窗 |
|------|------|----------|
| 创建要素库 | 点击"+ 创建要素库"按钮 | 弹出创建表单 |
| 查看基础信息 | 点击"基础信息"按钮 | 弹出详情弹窗 |
| 编辑要素 | 点击"编辑要素"按钮 | 跳转到要素编辑页面 |
| 发布 | 点击"发布"按钮 | 执行发布校验 |
| 取消发布 | 点击"取消发布"按钮 | 弹出确认对话框 |
| 删除 | 点击"删除"按钮 | 弹出确认对话框 |

---

### UC-ELEM-01: 创建要素库

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-01 |
| 用例名称 | 创建要素库 |
| 用例简述 | 系统管理员创建新的要素库，设置基础信息（名称、描述），创建后进入要素编辑页面添加要素 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限 |
| 后置条件 | 要素库创建成功，状态为"草稿"，跳转到要素编辑页面 |

**输入字段：**
| 字段 | 类型 | 必填 | 限制 | 说明 |
|------|------|:----:|------|------|
| 名称 | string | ✓ | 1-100字符，不可重复 | 要素库显示名称 |
| 描述 | string | | 0-500字符 | 要素库用途说明 |

**创建表单界面：**
```
┌─ 创建要素库 ────────────────────────────────────────┐
│                                                     │
│ * 要素库名称                                        │
│   [___________________________________]             │
│                                                     │
│   要素库描述                                        │
│   [___________________________________]             │
│   [___________________________________]             │
│   [___________________________________]             │
│                                                     │
│                          [取消]    [创建并编辑要素]  │
└─────────────────────────────────────────────────────┘
```

**主流程：**
1. 在列表页点击"+ 创建要素库"按钮
2. 弹出创建表单
3. 填写要素库名称（必填）
4. 填写描述（选填）
5. 点击"创建并编辑要素"
6. 系统创建要素库，状态设为"草稿"
7. 跳转到要素编辑页面

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 名称为空 | 提示"请输入要素库名称" |
| 名称重复 | 提示"该名称已存在" |
| 名称超长 | 提示"名称不能超过100字符" |

---

### UC-ELEM-02: 编辑要素库基本信息

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-02 |
| 用例名称 | 编辑要素库基本信息 |
| 用例简述 | 系统管理员编辑要素库的基本信息（名称、描述） |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限，要素库状态为草稿或编辑中 |
| 后置条件 | 要素库基本信息更新成功 |

**可编辑字段：**
| 字段 | 类型 | 必填 | 限制 | 说明 |
|------|------|:----:|------|------|
| 名称 | string | ✓ | 1-100字符，不可重复 | 要素库显示名称 |
| 描述 | string | | 0-500字符 | 要素库用途说明 |

**详情弹窗界面：**
```
┌─ 要素库信息 ────────────────────────────────────────┐
│                                                     │
│ * 要素库名称                                        │
│   [义务教育基础数据要素库_______________]            │
│                                                     │
│   要素库描述                                        │
│   [包含学校基本信息、师资配置、学生数据等_]          │
│   [基础采集要素___________________________]          │
│   [___________________________________]             │
│                                                     │
│   状态: 已发布                                      │
│   创建时间: 2025-01-10 10:30:00                     │
│   创建人: admin                                     │
│   更新时间: 2025-01-15 14:20:00                     │
│   更新人: admin                                     │
│   要素数量: 45                                      │
│                                                     │
│                               [取消]    [保存]      │
└─────────────────────────────────────────────────────┘
```

**主流程：**
1. 在列表页点击"基础信息"按钮
2. 弹出详情弹窗，显示当前信息
3. 修改需要更新的字段
4. 点击"保存"按钮
5. 系统验证并保存修改
6. 关闭弹窗，刷新列表

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 名称为空 | 提示"请输入要素库名称" |
| 名称重复 | 提示"该名称已存在" |
| 已发布状态 | 名称字段只读，仅可修改描述 |

---

### UC-ELEM-03: 管理要素（添加/编辑/删除）

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-03 |
| 用例名称 | 管理要素 |
| 用例简述 | 在要素编辑页面添加、编辑、删除要素，配置要素属性和关联关系 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限，要素库状态为草稿或编辑中 |
| 后置条件 | 要素变更保存成功，要素库状态更新为"编辑中" |

**页面布局：**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ← 返回   义务教育基础数据要素库                              [保存] [预览]  │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  [全部类型 ▼]  [搜索要素________________🔍]                [+ 添加要素]     │
│                                                                              │
├──────────────────────────────────────────────┬───────────────────────────────┤
│               要素列表                        │         要素属性配置          │
├──────────────────────────────────────────────┤                               │
│ ┌──────────────────────────────────────────┐ │  编码                         │
│ │ 📊 student_count                         │ │  [student_count________]      │
│ │    在校学生数            基础要素  数字   │ │                               │
│ │    采集级别: 学校级      关联工具: 学校... │ │  名称                         │
│ │                          [✏️] [🗑️]      │ │  [在校学生数____________]      │
│ └──────────────────────────────────────────┘ │                               │
│ ┌──────────────────────────────────────────┐ │  要素类型                     │
│ │ 📊 teacher_count                         │ │  ○ 基础要素  ○ 派生要素       │
│ │    专任教师数            基础要素  数字   │ │  ○ 满意度要素                 │
│ │    采集级别: 学校级      关联工具: 学校... │ │                               │
│ │                          [✏️] [🗑️]      │ │  数据类型                     │
│ └──────────────────────────────────────────┘ │  [数字 ▼]                     │
│ ┌──────────────────────────────────────────┐ │                               │
│ │ 🔢 student_teacher_ratio                 │ │  采集级别                     │
│ │    师生比                派生要素  数字   │ │  ○ 学校级  ○ 区县级  ○ 自动  │
│ │    公式: teacher_count / student_count   │ │                               │
│ │                          [✏️] [🗑️]      │ │  ── 基础要素配置 ──           │
│ └──────────────────────────────────────────┘ │                               │
│ ┌──────────────────────────────────────────┐ │  关联采集工具                 │
│ │ 📊 parent_satisfaction                   │ │  [学校基本信息采集表 ▼]       │
│ │    家长满意度            满意度  百分比   │ │                               │
│ │    关联问卷: 家长满意度调查  阈值: 60分   │ │  关联字段                     │
│ │                          [✏️] [🗑️]      │ │  [在校学生数 ▼]               │
│ └──────────────────────────────────────────┘ │                               │
│                                              │  聚合方式                     │
│                                              │  [求和 ▼]                     │
│                                              │                               │
│                                              │           [取消] [保存要素]    │
└──────────────────────────────────────────────┴───────────────────────────────┘
```

**要素类型配置：**

**1. 基础要素配置**
| 属性 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| 编码 | string | ✓ | 唯一标识，如 `student_count` |
| 名称 | string | ✓ | 显示名称 |
| 数据类型 | enum | ✓ | 文本/数字/日期/时间/逻辑/数组/文件 |
| 采集级别 | enum | ✓ | 学校级/区县级/自动 |
| 关联工具 | ref | ✓ | 选择采集工具 |
| 关联字段 | ref | ✓ | 选择工具中的表单字段（显示字段ID供选择） |
| 聚合方式 | enum | | 多填报数据汇总方式 |

**2. 派生要素配置**
| 属性 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| 编码 | string | ✓ | 唯一标识 |
| 名称 | string | ✓ | 显示名称 |
| 数据类型 | enum | ✓ | 通常为数字 |
| 采集级别 | enum | ✓ | 学校级/区县级/自动 |
| 计算公式 | string | ✓ | 如 `teacher_count / student_count` |
| 引用要素 | ref[] | ✓ | 公式中引用的要素列表（自动解析） |

**派生要素公式语法：**
| 运算符 | 说明 | 示例 |
|--------|------|------|
| + | 加法 | `a + b` |
| - | 减法 | `a - b` |
| * | 乘法 | `a * b` |
| / | 除法 | `a / b` |
| () | 优先级 | `(a + b) / c` |
| 函数 | 聚合函数 | `SUM(items)`, `AVG(items)` |

**3. 满意度要素配置**
| 属性 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| 编码 | string | ✓ | 唯一标识 |
| 名称 | string | ✓ | 显示名称 |
| 关联问卷工具 | ref | ✓ | 问卷类型采集工具 |
| 问卷满分 | number | ✓ | 自动从问卷获取 |
| 满意阈值 | number | ✓ | ≥此分数判定为满意 |

**添加要素弹窗：**
```
┌─ 添加要素 ────────────────────────────────────────────────────┐
│                                                               │
│ 要素类型                                                      │
│ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐               │
│ │  📊 基础要素 │ │  🔢 派生要素 │ │  📈 满意度  │               │
│ │  直接采集   │ │  公式计算   │ │  问卷统计   │               │
│ └─────────────┘ └─────────────┘ └─────────────┘               │
│                                                               │
│ * 要素编码                                                    │
│   [___________________________________]                       │
│   用于公式引用和数据导出，如 student_count                    │
│                                                               │
│ * 要素名称                                                    │
│   [___________________________________]                       │
│                                                               │
│ * 数据类型                                                    │
│   [数字 ▼]                                                    │
│                                                               │
│ * 采集级别                                                    │
│   ○ 学校级  ○ 区县级  ○ 自动判断                            │
│                                                               │
│ ── 基础要素配置（基础要素时显示） ──                          │
│                                                               │
│ * 关联采集工具                                                │
│   [请选择采集工具 ▼]                                          │
│                                                               │
│ * 关联字段                                                    │
│   [请先选择采集工具 ▼]                                        │
│                                                               │
│   聚合方式                                                    │
│   [求和 ▼]                                                    │
│   当同一评估对象有多份填报时的汇总方式                        │
│                                                               │
│ ── 派生要素配置（派生要素时显示） ──                          │
│                                                               │
│ * 计算公式                                                    │
│   [teacher_count / student_count___]                          │
│   可用要素: student_count, teacher_count, class_count...      │
│   支持运算符: + - * / ()                                      │
│                                                               │
│ ── 满意度配置（满意度要素时显示） ──                          │
│                                                               │
│ * 关联问卷工具                                                │
│   [请选择问卷类型工具 ▼]                                      │
│                                                               │
│   问卷满分                                                    │
│   [100] 分（自动从问卷获取）                                  │
│                                                               │
│ * 满意阈值                                                    │
│   [60] 分                                                     │
│   ≥此分数判定为"满意"                                        │
│                                                               │
│                                    [取消]    [保存]           │
└───────────────────────────────────────────────────────────────┘
```

**主流程（添加要素）：**
1. 点击"+ 添加要素"按钮
2. 弹出添加要素对话框
3. 选择要素类型（基础/派生/满意度）
4. 填写通用属性（编码、名称、数据类型、采集级别）
5. 根据类型填写特有属性
6. 点击"保存"
7. 系统验证并保存要素
8. 刷新要素列表

**主流程（编辑要素）：**
1. 在要素列表点击要素行，右侧显示属性配置
2. 或点击"✏️"按钮弹出编辑对话框
3. 修改需要更新的属性
4. 点击"保存要素"
5. 系统验证并保存修改

**主流程（删除要素）：**
1. 点击要素行的"🗑️"按钮
2. 系统检查要素是否被引用
3. 弹出确认对话框
4. 点击"确认删除"
5. 系统删除要素，刷新列表

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 编码为空 | 提示"请输入要素编码" |
| 编码重复 | 提示"该编码已存在" |
| 编码格式错误 | 提示"编码只能包含字母、数字和下划线" |
| 名称为空 | 提示"请输入要素名称" |
| 未选择关联工具 | 提示"请选择关联采集工具"（基础要素） |
| 未选择关联字段 | 提示"请选择关联字段"（基础要素） |
| 公式为空 | 提示"请输入计算公式"（派生要素） |
| 公式语法错误 | 提示"公式语法错误：{具体错误}" |
| 引用不存在的要素 | 提示"公式中引用的要素 xxx 不存在" |
| 循环引用 | 提示"检测到循环引用：a → b → a" |
| 要素被引用 | 提示"该要素被以下派生要素引用，无法删除：{要素列表}" |
| 要素被指标引用 | 提示"该要素被以下数据指标引用，无法删除：{指标列表}" |

---

### UC-ELEM-04: 发布要素库

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-04 |
| 用例名称 | 发布要素库 |
| 用例简述 | 将编辑中的要素库发布，发布后可被项目引用，要素不可修改 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限，要素库状态为草稿或编辑中 |
| 后置条件 | 要素库状态变为"已发布" |

**发布校验规则：**
| 校验项 | 规则 | 错误提示 |
|--------|------|----------|
| 要素数量 | 至少包含1个要素 | "要素库中至少需要包含1个要素" |
| 要素完整性 | 所有要素必填字段已填写 | "要素 {name} 配置不完整：{缺失字段}" |
| 派生要素引用 | 派生要素引用的要素都存在 | "派生要素 {name} 引用了不存在的要素：{code}" |
| 循环引用检查 | 派生要素不能循环引用 | "检测到循环引用：{引用链}" |
| 工具关联有效 | 基础要素关联的工具和字段有效 | "要素 {name} 关联的采集工具/字段不存在" |

**发布确认对话框：**
```
┌─ 确认发布 ────────────────────────────────────────┐
│                                                   │
│  确定要发布"义务教育基础数据要素库"吗？            │
│                                                   │
│  发布后：                                          │
│  • 该要素库可被项目选用                            │
│  • 要素配置将锁定，不可修改                        │
│  • 如需修改，需先取消发布                          │
│                                                   │
│  要素统计：                                        │
│  • 基础要素：32 个                                 │
│  • 派生要素：10 个                                 │
│  • 满意度要素：3 个                                │
│                                                   │
│                        [取消]    [确认发布]        │
└───────────────────────────────────────────────────┘
```

**主流程：**
1. 在列表页点击"发布"按钮
2. 系统执行发布校验
3. 校验通过，弹出确认对话框
4. 显示要素统计信息
5. 点击"确认发布"
6. 状态更新为"已发布"
7. 刷新列表

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 校验失败 | 弹出错误提示，列出所有问题 |
| 无要素 | 提示"要素库中至少需要包含1个要素" |

---

### UC-ELEM-05: 取消发布要素库

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-05 |
| 用例名称 | 取消发布要素库 |
| 用例简述 | 将已发布的要素库恢复为编辑中状态，若被项目使用则显示警告提示 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限，要素库状态为"已发布" |
| 后置条件 | 要素库状态变为"编辑中" |

> **引用机制说明**：项目通过拷贝方式使用要素库。取消发布后，已使用该库的项目不受影响（使用的是拷贝），但新项目无法选用。

**确认对话框（未被使用）：**
```
┌─ 确认取消发布 ────────────────────────────────────┐
│                                                   │
│  确定要取消发布"义务教育基础数据要素库"吗？        │
│                                                   │
│  取消发布后，该要素库将无法被新项目选用。          │
│                                                   │
│                        [取消]    [确认取消发布]    │
└───────────────────────────────────────────────────┘
```

**确认对话框（被项目使用时）：**
```
┌─ 确认取消发布 ────────────────────────────────────┐
│                                                   │
│  ⚠️ 该要素库已被以下项目使用：                     │
│  • 2024年义务教育督导评估                         │
│  • 2024年学前教育专项督导                         │
│                                                   │
│  确定要取消发布"义务教育基础数据要素库"吗？        │
│                                                   │
│  取消发布后：                                      │
│  • 已使用该库的项目不受影响（使用的是拷贝）        │
│  • 新项目将无法选用该要素库                        │
│                                                   │
│                        [取消]    [确认取消发布]    │
└───────────────────────────────────────────────────┘
```

**主流程：**
1. 在列表页点击"取消发布"按钮
2. 系统检查该要素库是否被项目使用
3. 弹出确认对话框（若被使用则显示警告信息）
4. 点击"确认取消发布"
5. 状态更新为"编辑中"
6. 刷新列表

---

### UC-ELEM-06: 删除要素库

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-06 |
| 用例名称 | 删除要素库 |
| 用例简述 | 删除要素库及其所有要素，需检查是否被项目引用 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限，要素库状态为草稿或编辑中 |
| 后置条件 | 要素库及所有要素从系统中移除 |

**引用检查：**
| 检查项 | 说明 |
|--------|------|
| 项目引用 | 检查是否有项目配置引用该要素库 |

**确认对话框：**
```
┌─ 确认删除 ────────────────────────────────────────┐
│                                                   │
│  ⚠️ 确定要删除"教育质量评估要素库"吗？             │
│                                                   │
│  删除后将无法恢复，包括：                          │
│  • 要素库基本信息                                  │
│  • 库中所有要素（共 32 个）                        │
│                                                   │
│                          [取消]    [确认删除]      │
└───────────────────────────────────────────────────┘
```

**主流程：**
1. 在列表页点击"删除"按钮
2. 系统检查该要素库是否被项目引用
3. 若未被引用，弹出确认对话框
4. 点击"确认删除"
5. 系统执行级联删除（要素库及其所有要素）
6. 刷新列表

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 已发布状态 | 删除按钮隐藏或禁用 |
| 被项目引用 | 提示"该要素库正被以下项目引用，无法删除：{项目名称列表}" |

---

### UC-ELEM-07: 查看要素库详情

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-ELEM-07 |
| 用例名称 | 查看要素库详情 |
| 用例简述 | 查看要素库的完整信息，包括基本信息和要素预览列表 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限 |
| 后置条件 | 无状态变更 |

**详情页面布局：**
```
┌─────────────────────────────────────────────────────────────────────────────┐
│ ← 返回   义务教育基础数据要素库                                   [编辑要素] │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  基本信息                                                                    │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 状态: 已发布          创建时间: 2025-01-10 10:30:00    创建人: admin   ││
│  │ 要素数: 45            更新时间: 2025-01-15 14:20:00    更新人: admin   ││
│  │ 描述: 包含学校基本信息、师资配置、学生数据等基础采集要素                ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
│  要素统计                                                                    │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐                      │
│  │  基础要素     │  │  派生要素     │  │  满意度要素   │                      │
│  │     32       │  │     10       │  │      3       │                      │
│  └──────────────┘  └──────────────┘  └──────────────┘                      │
│                                                                              │
│  要素列表预览                                                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐│
│  │ 编码              │ 名称          │ 类型      │ 数据类型 │ 采集级别     ││
│  ├───────────────────┼───────────────┼───────────┼──────────┼──────────────┤│
│  │ student_count     │ 在校学生数    │ 基础要素  │ 数字     │ 学校级       ││
│  │ teacher_count     │ 专任教师数    │ 基础要素  │ 数字     │ 学校级       ││
│  │ student_teacher   │ 师生比        │ 派生要素  │ 数字     │ 学校级       ││
│  │ parent_satisfact  │ 家长满意度    │ 满意度    │ 百分比   │ 学校级       ││
│  │ ...               │ ...           │ ...       │ ...      │ ...          ││
│  └─────────────────────────────────────────────────────────────────────────┘│
│                                                                              │
└─────────────────────────────────────────────────────────────────────────────┘
```

**主流程：**
1. 在列表页点击要素库名称
2. 跳转到详情页面
3. 显示基本信息区域
4. 显示要素统计卡片
5. 显示要素列表预览（只读）
6. 可点击"编辑要素"进入编辑页面

---

## 核心操作流程

```
创建要素库 → 添加要素 → 配置要素属性 → 关联采集工具字段 → 发布要素库
                ↓
           派生要素：配置计算公式
                ↓
           多填报要素：配置聚合方式
```
