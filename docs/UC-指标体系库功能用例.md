# 指标体系库功能用例

> 本文档从 PRD-产品需求说明书.md 抽取，描述指标体系库模块的详细功能用例。

## 概述

指标体系是评估项目的核心框架，定义了评估的维度、指标和达标标准。

### 指标体系类型

| 类型 | 说明 | 评估方式 |
|------|------|----------|
| 达标类 | 以达标/不达标为评估结果 | 每项指标设置达标阈值，统计达标率 |
| 评分类 | 以分数为评估结果 | 每项指标设置权重，加权计算总分 |

### 指标树结构（2-3级灵活结构）

| 层级 | 名称 | 说明 | 特点 |
|------|------|------|------|
| 1 | 一级指标 | 评估大类/维度 | 必须存在，包含子指标 |
| 2 | 二级指标 | 评估子类/方面 | 可作为叶子节点或包含三级指标 |
| 3 | 三级指标 | 具体评估点（可选） | 叶子节点 |

> **叶子节点**：没有子指标的节点（二级或三级），可配置数据指标和佐证材料

### 指标体系状态

| 状态 | 说明 | 可执行操作 |
|------|------|------------|
| draft | 草稿 | 编辑、删除 |
| editing | 编辑中 | 编辑、发布 |
| published | 已发布 | 取消发布 |

---

## 功能用例

### UC-IND-00: 查看指标体系列表

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-00 |
| 用例名称 | 查看指标体系列表 |
| 用例简述 | 系统管理员进入指标体系库页面，查看概况统计和指标体系列表，支持按状态筛选和关键字搜索 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限 |
| 后置条件 | 无状态变更 |

**页面入口：**
- 左侧菜单：系统配置 → 指标体系库

**页面布局：**
```
┌─ 指标体系概况 ────────────────────────────────────────────────────────────────┐
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐       │
│  │ 体系总数  │  │  已发布   │  │  编辑中   │  │  达标类   │  │  评分类   │       │
│  │    3     │  │    2     │  │    1     │  │    2     │  │    1     │       │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘  └──────────┘       │
└───────────────────────────────────────────────────────────────────────────────┘

┌─ 评估指标体系列表 ──────────────────────────────────────────────────────────────┐
│  [全部状态 ▼]  [搜索指标体系________________🔍]     [+ 创建评估指标体系]       │
├───────────────────────────────────────────────────────────────────────────────┤
│ ┌─────────────────────────────────────────────────────────────────────────┐   │
│ │ 义务教育优质均衡发展评估指标体系（测试版） [达标类] [评估对象: 区县]      │   │
│ │                                                        指标数: 30  草稿 │   │
│ │ 创建时间: 2025-12-18  创建人: admin  更新时间: 2025-12-25  更新人: admin │   │
│ │                                                                         │   │
│ │                           [◉ 基础信息] [品 编辑指标] [发布] [🗑️ 删除]   │   │
│ └─────────────────────────────────────────────────────────────────────────┘   │
│ ┌─────────────────────────────────────────────────────────────────────────┐   │
│ │ 教育质量监测指标体系  [评分类] [评估对象: 学校]            指标数: 0  已发布│   │
│ │ 用于监测学校教育质量的综合指标体系，重点关注学生发展水平、教师专业能力... │   │
│ │ 创建时间: 2024-06-01  创建人: BBB  更新时间: 2025-12-16  更新人: admin   │   │
│ │                                                                         │   │
│ │                           [◉ 基础信息] [品 编辑指标] [取消发布]          │   │
│ └─────────────────────────────────────────────────────────────────────────┘   │
└───────────────────────────────────────────────────────────────────────────────┘
```

**概况统计卡片：**
| 统计项 | 说明 | 图标颜色 |
|--------|------|----------|
| 体系总数 | 所有指标体系数量 | 蓝色 |
| 已发布 | status='published' 的数量 | 绿色 |
| 编辑中 | status='editing' 的数量 | 橙色 |
| 达标类 | type='达标类' 的数量 | 青色 |
| 评分类 | type='评分类' 的数量 | 紫色 |

**列表筛选：**
| 筛选项 | 类型 | 选项 |
|--------|------|------|
| 状态筛选 | 下拉单选 | 全部状态 / 草稿 / 编辑中 / 已发布 |
| 关键字搜索 | 输入框 | 按名称模糊搜索 |

**列表项展示：**
| 信息 | 说明 |
|------|------|
| 名称 | 指标体系名称，可点击查看详情 |
| 类型标签 | 达标类（蓝色）/ 评分类（蓝色） |
| 评估对象标签 | 如"评估对象: 区县"（青色） |
| 描述 | 指标体系描述（可选，显示时截断） |
| 创建信息 | 创建时间、创建人 |
| 更新信息 | 更新时间、更新人 |
| 指标数 | 该体系下的指标总数 |
| 状态 | 草稿（灰色）/ 编辑中（橙色）/ 已发布（绿色） |

**操作按钮（按状态显示）：**
| 状态 | 可用操作 |
|------|----------|
| 草稿 | 基础信息、编辑指标、发布、删除 |
| 编辑中 | 基础信息、编辑指标、发布、删除 |
| 已发布 | 基础信息、编辑指标、取消发布 |

**主流程：**
1. 进入指标体系库页面
2. 页面顶部显示概况统计（体系总数、已发布、编辑中、达标类、评分类）
3. 列表区域显示所有指标体系，按更新时间倒序排列
4. 可通过状态下拉筛选（全部/草稿/编辑中/已发布）
5. 可通过搜索框按名称模糊搜索
6. 点击列表项可展开/收起详情
7. 根据状态显示不同的操作按钮

**操作入口：**
| 操作 | 入口 | 跳转/弹窗 |
|------|------|----------|
| 创建指标体系 | 点击"+ 创建评估指标体系"按钮 | 弹出创建表单 |
| 查看基础信息 | 点击"基础信息"按钮 | 弹出详情弹窗 |
| 编辑指标 | 点击"编辑指标"按钮 | 跳转到指标树编辑页面 |
| 发布 | 点击"发布"按钮 | 执行发布校验 |
| 取消发布 | 点击"取消发布"按钮 | 弹出确认对话框 |
| 删除 | 点击"删除"按钮 | 弹出确认对话框 |

---

### UC-IND-01: 创建指标体系

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-01 |
| 用例名称 | 创建指标体系 |
| 用例简述 | 系统管理员创建新的指标体系，设置基础信息（名称、类型、描述等），创建后进入指标树编辑页面进行指标结构设计 |
| 参与者 | 系统管理员 |
| 前置条件 | 用户已登录且具有 canManageSystem 权限 |
| 后置条件 | 指标体系创建成功，状态为"草稿"，跳转到指标树编辑页面 |

**输入字段：**
| 字段 | 类型 | 必填 | 限制 | 说明 |
|------|------|:----:|------|------|
| 名称 | string | ✓ | 1-100字符，不可重复 | 指标体系显示名称 |
| 类型 | enum | ✓ | 达标类 \| 评分类 | 决定评估方式 |
| 评估对象 | string | ✓ | 1-50字符 | 如"学校"、"区县"等 |
| 描述 | string | | 0-1000字符 | 详细描述信息 |
| 标签 | string[] | | 每个标签1-20字符，最多10个 | 分类标签/关键字 |
| 附件 | file[] | | 单文件≤10MB，支持pdf/doc/docx，最多5个 | 政策文件等 |

**主流程：**
1. 点击"新建指标体系"按钮，弹出创建表单
2. 填写名称（必填，系统校验唯一性）
3. 选择指标体系类型（达标类/评分类）
4. 填写评估对象（必填，如"学校"）
5. 填写描述（可选）
6. 添加标签（可选，支持手动输入或选择已有标签）
7. 上传附件（可选）
8. 点击"创建"按钮提交

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 名称为空 | 表单校验失败，提示"请输入指标体系名称" |
| 名称重复 | 提交时校验失败，提示"该名称已存在" |
| 名称超长 | 输入时截断，提示"名称不能超过100字符" |
| 附件超大 | 上传失败，提示"文件大小不能超过10MB" |
| 附件格式错误 | 上传失败，提示"仅支持pdf/doc/docx格式" |

---

### UC-IND-02: 构建指标树结构

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-02 |
| 用例名称 | 构建指标树结构 |
| 用例简述 | 在指标树编辑页面，通过添加、删除、移动、层级调整等操作构建2-3级灵活指标层次结构，系统自动生成规范化编码 |
| 参与者 | 系统管理员 |
| 前置条件 | 指标体系已创建，状态为"草稿"或"编辑中" |
| 后置条件 | 指标树结构保存成功，编码自动生成 |

**指标节点显示格式：**
| 元素 | 显示 | 说明 |
|------|------|------|
| 层级标签 | `L1` `L2` `L3` | 蓝色圆角标签，标识指标层级 |
| 编码 | `1` `1.1` `2.1` | 指标编号 |
| 名称 | 指标名称文字 | 主要显示内容 |
| 说明 | 灰色小字 | 指标说明（展开时显示） |
| 数据指标 | `数据指标` 标签 + 编码 + 名称 + 阈值标签 | 末级指标下显示 |
| 佐证资料 | `佐证资料` 标签 + 编码 + 名称 + 文件类型 | 末级指标下显示 |

**节点操作按钮组：**
| 按钮 | 图标 | 功能 | 可用条件 |
|------|:----:|------|----------|
| 上移 | ∧ | 与上一个同级节点交换位置 | 非同级首个节点 |
| 下移 | ∨ | 与下一个同级节点交换位置 | 非同级末个节点 |
| 升级 | < | 提升一个层级（变为父节点的兄弟） | 非一级指标 |
| 降级 | > | 降低一个层级（变为上一兄弟的子节点） | 非三级指标且存在上一兄弟节点 |
| 添加 | + | 添加子指标 | 非三级指标且非末级指标 |
| 编辑 | ✏️ | 编辑指标详情（弹窗） | 始终可用 |
| 删除 | 🗑️ | 删除指标及子节点 | 始终可用（需确认） |

**编码生成规则：**
| 层级 | 格式 | 示例 |
|------|------|------|
| 一级 | 数字 | 1, 2, 3... |
| 二级 | 一级编码.数字 | 1.1, 1.2, 2.1... |
| 三级 | 二级编码.数字 | 1.1.1, 1.1.2, 2.1.1... |
| 数据指标 | 父编码-D数字 | 1.1-D1, 1.1-D2, 2.1-D1... |
| 佐证资料 | 父编码-M数字 | 1.1-M1, 2.1-M1... |

**界面布局：**
```
┌─────────────────────────────────────────────────────────────────────────────────┐
│ 指标树编辑                                                                       │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                  │
│ ▼ [L1] 1  资源配置（需计算差异系数）                           ∧∨ < > + ✏️ 🗑️  │
│   │   7个学校指标：每所学校至少有6项指标达到要求...                              │
│   │                                                                              │
│   └─ [L2] 1.1  区级资源配置综合评价                            ∧∨ < >   ✏️ 🗑️  │
│         │   区级汇总：所有学校七项指标达标率=100%...                             │
│         │                                                                        │
│         ├─ [1.1-D1] [数据指标] 【区】七项指标达标率        [=100%]      ✏️ 🗑️  │
│         │   区内所有义务教育学校资源配置7项指标达标学校数÷区内义务教育学校总数   │
│         │                                                                        │
│         ├─ [1.1-D2] [数据指标] 【区】小学校际差异系数      [<=0.50]     ✏️ 🗑️  │
│         │   区内7项资源配置指标的小学校际差异系数均≤0.50                         │
│         │                                                                        │
│         └─ [1.1-D3] [数据指标] 【区】初中校际差异系数      [<=0.45]     ✏️ 🗑️  │
│                                                                                  │
│ ▼ [L1] 2  政府保障程度                                         ∧∨ < > + ✏️ 🗑️  │
│   │   15项指标均要达到要求（以政策落实、保障机制与关键约束为主）                 │
│   │                                                                              │
│   └─ [L2] 2.1  县域内义务教育学校规划布局合理，符合国家规定要求  ∧∨ < >   ✏️ 🗑️│
│         │   不需要数值数据，需提供规划布局、批复与实施等佐证资料                 │
│         │                                                                        │
│         └─ [2.1-M1] [佐证资料] 县域义务教育学校规划布局合理佐证材料              │
│                     (PDF,Word,Excel,JPG,PNG)                                     │
│                     提供县域义务教育学校布局规划、调整方案、批复文件、规划图等佐证│
│                                                                                  │
└─────────────────────────────────────────────────────────────────────────────────┘
```

**主流程：**
1. 进入指标树编辑页面，显示树形结构列表
2. 点击"+ 添加一级指标"，创建根节点
3. 点击节点右侧"+"按钮添加子指标
4. 点击"✏️"按钮编辑指标详情（弹出编辑对话框）
5. 使用"∧∨"按钮调整同级顺序，或使用"<>"按钮调整层级
6. 在末级指标中配置数据指标或佐证资料
7. 系统自动保存，编码自动生成/更新

> **灵活结构说明**：二级指标可以直接作为末级节点配置数据指标，无需强制创建三级指标

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 三级指标点击"+"添加 | 按钮隐藏或禁用 |
| 末级指标（有数据指标）点击"+"添加 | 提示"末级指标不能添加子节点，请先关闭末级开关" |
| 一级指标点击"<"升级 | 按钮禁用 |
| 首个同级节点点击"∧"上移 | 按钮禁用 |
| 删除含子节点的指标 | 弹窗确认"删除后子指标将一并删除，是否继续？" |
| 指标名称为空 | 保存时校验失败，高亮显示问题节点 |

---

### UC-IND-03: 编辑指标节点

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-03 |
| 用例名称 | 编辑指标节点 |
| 用例简述 | 编辑指标节点的基本信息、设置是否为末级指标、配置评价依据（数据指标和/或佐证资料） |
| 参与者 | 系统管理员 |
| 前置条件 | 指标体系已创建，指标节点已存在 |
| 后置条件 | 指标节点信息更新成功 |

**触发方式：**
- 在指标树中选中指标节点，点击"编辑"按钮
- 弹出"编辑指标"对话框

**指标基本信息字段：**
| 字段 | 类型 | 必填 | 限制 | 说明 |
|------|------|:----:|------|------|
| 指标名称 | string | ✓ | 1-200字符 | 指标显示名称 |
| 指标说明 | string | | 0-500字符 | 指标评估标准的详细说明 |
| 是否为末级指标 | boolean | ✓ | 开关控件 | 末级指标可配置评价依据 |
| 评价依据 | checkbox[] | | 数据指标 \| 佐证资料 | 末级指标时显示，可多选 |

**末级指标设置规则：**
| 场景 | 规则 |
|------|------|
| 开启"末级指标" | 显示评价依据配置区域，可添加数据指标和佐证资料 |
| 关闭"末级指标" | 隐藏评价依据配置，已配置的数据指标需确认清除 |
| 存在子指标时 | "末级指标"开关禁用，Tooltip提示"存在子指标，无法设为末级" |

**数据指标配置：**
| 字段 | 类型 | 必填 | 限制 | 说明 |
|------|------|:----:|------|------|
| 编码 | string | ✓ | 1-50字符，体系内唯一 | 数据指标标识，如 1.1-D1 |
| 适用范围 | enum | | 全部 \| 幼儿园 \| 小学 \| 初中 \| ... | 指标适用的学校类型，默认全部 |
| 名称 | string | ✓ | 1-200字符 | 数据指标名称 |
| 达标阈值 | enum | ✓ | 单值比较 \| 区间 | 阈值判定方式 |
| 精确位数 | enum | ✓ | 整数 \| 1位 \| 2位 \| 3位 | 数值精度，默认2位 |
| 比较运算符 | enum | | = \| >= \| <= \| > \| < | 单值比较时选择 |
| 阈值 | string | ✓ | 数值或百分比 | 达标判定标准，显示为标签 |
| 说明 | string | | 0-500字符 | 计算公式或指标详细说明 |

**达标阈值类型：**
| 类型 | 配置项 | 示例 | 说明 |
|------|--------|------|------|
| 单值比较 | 运算符 + 阈值 | >= 5%、<= 0.50、= 100% | 与单一阈值比较判定达标 |
| 区间 | 最小值 ~ 最大值 | [85, 100]、[0.5, 1.5] | 数值在区间内则达标 |

**精确位数：**
| 选项 | 说明 | 示例 |
|------|------|------|
| 整数 | 不保留小数 | 100、85 |
| 1位 | 保留1位小数 | 85.5、0.5 |
| 2位 | 保留2位小数（默认） | 85.50、0.50 |
| 3位 | 保留3位小数 | 0.456、1.234 |

**数据指标编辑界面：**
```
┌─────────────────────────────────────────────────────────────────┐
│ [3.4-D1]  [幼儿园 ▼]  教师培训经费占公用经费预算比例            │
├─────────────────────────────────────────────────────────────────┤
│ 达标阈值  [单值比较 ▼]          精确位数  [2位 ▼]              │
│                                           ┌────────┐            │
│ 【数据指标】 [>= ▼]  [5%        ]         │ 整数   │            │
│                                           │ 1位    │            │
│ 数据指标说明                              │ 2位 ✓  │            │
│ ┌─────────────────────────────────────┐   │ 3位    │            │
│ │ 教师培训经费预算总额 ÷ 公用经费预算总│   └────────┘            │
│ └─────────────────────────────────────┘                         │
│                                           [× 取消]  [✓ 确认]    │
└─────────────────────────────────────────────────────────────────┘
```

**佐证资料配置：**
| 字段 | 类型 | 必填 | 限制 | 说明 |
|------|------|:----:|------|------|
| 编码 | string | ✓ | 1-50字符，体系内唯一 | 材料标识，如 1.1-M1 |
| 适用范围 | enum | | 全部 \| 幼儿园 \| 小学 \| 初中 \| ... | 材料适用的学校类型，默认全部 |
| 名称 | string | ✓ | 1-200字符 | 材料名称 |
| 最大文件大小 | number | | 1-100，默认10 | 单位MB |
| 文件类型 | string[] | | PDF/Word/Excel/JPG/PNG | 允许的文件格式，Tag多选 |
| 是否必填 | boolean | | 默认false | 是否必须上传 |
| 说明 | string | | 0-500字符 | 材料要求说明 |

**界面布局：**
```
┌─ 编辑指标 ──────────────────────────────────────┐
│ 修改指标信息                                    │
│                                                 │
│ * 指标名称                                      │
│ ┌─────────────────────────────────────────────┐│
│ │ 区级资源配置综合评价                         ││
│ └─────────────────────────────────────────────┘│
│                                                 │
│   指标说明                                      │
│ ┌─────────────────────────────────────────────┐│
│ │ 区级汇总：所有学校七项指标达标率=100%...     ││
│ └─────────────────────────────────────────────┘│
│                                                 │
│   是否为末级指标                                │
│   [====○] (开关)                               │
│                                                 │
│   评价依据                                      │
│   [✓] 数据指标    [ ] 佐证资料                 │
│                                                 │
│ ┌─ 数据指标 ─────────────────────── + 添加 ──┐ │
│ │                                             │ │
│ │ ┌─────────────────────────────────────────┐│ │
│ │ │ 1.1-D1  【区】七项指标达标率  [=100%]  ✏️🗑️││ │
│ │ │ 区内所有义务教育学校资源配置7项指标...   ││ │
│ │ └─────────────────────────────────────────┘│ │
│ │ ┌─────────────────────────────────────────┐│ │
│ │ │ 1.1-D2  【区】小学校际差异系数 [<=0.50] ✏️🗑️││ │
│ │ │ 区内7项资源配置指标的小学校际差异系数... ││ │
│ │ └─────────────────────────────────────────┘│ │
│ └─────────────────────────────────────────────┘ │
│                                                 │
│                        [取消]  [保存]           │
└─────────────────────────────────────────────────┘
```

**主流程：**
1. 选中指标节点，点击"编辑"按钮，弹出编辑对话框
2. 修改指标名称和说明
3. 设置"是否为末级指标"开关：
   - **开启**：显示评价依据区域
   - **关闭**：隐藏评价依据区域（如有已配置数据需确认清除）
4. 勾选评价依据类型（数据指标 / 佐证资料）
5. 配置数据指标（勾选"数据指标"时）：
   - 点击"+ 添加"按钮
   - 填写编码、适用范围、名称、达标阈值、精确位数、阈值、说明
   - 支持编辑（✏️）和删除（🗑️）已有数据指标
6. 配置佐证资料（勾选"佐证资料"时）：
   - 点击"+ 添加"按钮
   - 填写编码、适用范围、名称、最大文件大小、文件类型
   - 设置是否必填
   - 填写说明
7. 点击"保存"按钮

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 指标名称为空 | 提示"请输入指标名称" |
| 关闭末级开关但有数据指标 | 弹窗确认"关闭后将清除已配置的数据指标，是否继续？" |
| 数据指标编码重复 | 提示"编码已存在，请使用其他编码" |
| 阈值格式错误 | 提示"阈值格式不正确，支持格式：=、>=、<=、比例、区间" |
| 存在子指标时开启末级 | 开关禁用，Tooltip提示"存在子指标，无法设为末级指标" |

---

### UC-IND-04: 批量导入指标树

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-04 |
| 用例名称 | 批量导入指标树 |
| 用例简述 | 通过上传JSON文件批量导入指标树结构，支持替换或追加模式，系统自动解析、校验并规范化编码 |
| 参与者 | 系统管理员 |
| 前置条件 | 指标体系已创建 |
| 后置条件 | 指标树导入成功，替换或追加现有结构 |

**导入文件格式：**
```json
{
  "indicators": [
    {
      "code": "A",
      "name": "一级指标名称",
      "children": [
        {
          "code": "A1",
          "name": "二级指标（叶子节点示例）",
          "dataIndicators": [
            {
              "code": "A1-D1",
              "name": "数据指标名称",
              "threshold": "=100%"
            }
          ]
        },
        {
          "code": "A2",
          "name": "二级指标（含三级子节点示例）",
          "children": [
            {
              "code": "A2.1",
              "name": "三级指标名称",
              "weight": 10,
              "dataIndicators": [
                {
                  "code": "A2.1-D1",
                  "name": "数据指标名称",
                  "threshold": "≥90%"
                }
              ],
              "supportingMaterials": [
                {
                  "code": "A2.1-M1",
                  "name": "佐证材料名称",
                  "required": true
                }
              ]
            }
          ]
        }
      ]
    }
  ]
}
```

> **说明**：二级指标可以直接作为叶子节点配置数据指标（如A1），也可以包含三级子指标（如A2）

**导入参数：**
| 参数 | 类型 | 必填 | 说明 |
|------|------|:----:|------|
| 文件 | file | ✓ | JSON格式，≤5MB |
| 导入模式 | enum | ✓ | replace（替换）\| append（追加） |

**主流程：**
1. 点击"导入"按钮
2. 选择导入模式（替换现有/追加到末尾）
3. 上传JSON文件
4. 系统解析文件，显示预览（指标数量、层级结构）
5. 校验通过后，点击"确认导入"
6. 系统自动规范化编码（如有冲突）
7. 导入完成，刷新指标树

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 文件格式错误 | 提示"文件格式错误，请上传有效的JSON文件" |
| 文件过大 | 提示"文件大小不能超过5MB" |
| JSON结构错误 | 提示具体错误位置和原因 |
| 层级超过三级 | 警告并询问是否截断或取消 |
| 编码冲突 | 自动重新生成编码，在预览中标注 |

---

### UC-IND-05: 发布指标体系

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-05 |
| 用例名称 | 发布指标体系 |
| 用例简述 | 将指标体系从草稿/编辑中状态发布为可用状态，发布前系统执行完整性校验，发布后可被项目配置引用 |
| 参与者 | 系统管理员 |
| 前置条件 | 指标体系状态为"草稿"或"编辑中" |
| 后置条件 | 指标体系状态变为"已发布"，可在项目配置中选用 |

**发布校验规则：**
| 校验项 | 规则 | 错误提示 |
|--------|------|----------|
| 指标结构 | 至少包含一个叶子指标（二级或三级） | "请至少创建一个可配置数据指标的叶子节点" |
| 指标名称 | 所有指标名称不为空 | "存在未命名的指标：{编码列表}" |
| 数据指标 | 叶子指标至少有一个数据指标 | "以下叶子指标缺少数据指标：{编码列表}" |
| 权重（评分类） | 同级权重和等于100% | "以下层级权重配置不正确：{层级}" |
| 阈值格式 | 所有数据指标阈值格式正确 | "以下数据指标阈值格式错误：{编码列表}" |

**主流程：**
1. 在指标体系列表，点击目标体系的"发布"按钮
2. 系统执行发布校验
3. 校验通过，弹出确认对话框
4. 点击"确认发布"
5. 状态更新为"已发布"

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 校验失败 | 显示校验报告，列出所有问题，阻止发布 |
| 无叶子指标 | 提示"指标体系必须包含至少一个叶子指标" |

---

### UC-IND-06: 取消发布指标体系

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-06 |
| 用例名称 | 取消发布指标体系 |
| 用例简述 | 将已发布的指标体系恢复为编辑中状态，基于拷贝机制，此操作不影响已创建项目，仅阻止新项目选用 |
| 参与者 | 系统管理员 |
| 前置条件 | 指标体系状态为"已发布" |
| 后置条件 | 指标体系状态变为"编辑中"，新项目无法选用该体系 |

**设计说明：**
> **指标体系采用拷贝机制**：项目创建时会完整拷贝所选指标体系的快照，与原始指标体系解耦。因此取消发布**不会影响任何已创建的项目**，仅影响后续新项目的选择范围。

**影响范围：**
| 影响对象 | 是否受影响 | 说明 |
|----------|:----------:|------|
| 已创建项目 | ✗ | 项目持有指标体系的独立拷贝，不受原体系状态影响 |
| 新建项目 | ✓ | 取消发布后，新项目无法选择该指标体系 |

**主流程：**
1. 点击"取消发布"按钮
2. 弹出确认对话框，提示"取消发布后，新项目将无法选用该指标体系，是否继续？"
3. 点击"确认"
4. 状态更新为"编辑中"
5. 可继续编辑指标体系内容

**备注：**
- 取消发布后可重新编辑并再次发布
- 已使用该体系的项目数据保持独立，不受任何影响

---

### UC-IND-07: 查看指标体系详情（基础信息）

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-07 |
| 用例名称 | 查看指标体系详情 |
| 用例简述 | 点击"基础信息"按钮，弹窗查看指标体系的名称、状态、创建/更新信息、类型标签、描述及附件 |
| 参与者 | 系统管理员、项目管理员 |
| 前置条件 | 指标体系存在 |
| 后置条件 | 无状态变更 |

**触发方式：**
- 在指标体系列表，点击"基础信息"按钮

**弹窗布局：**
```
┌─────────────────────────────────────────────────────────────────┐
│ 义务教育优质均衡发展评估指标体系（2024版）          ● 已发布  ✕ │
├─────────────────────────────────────────────────────────────────┤
│ 创建时间: 2024-01-15 | 创建人: AAA | 更新时间: 2025-12-25 |    │
│ 更新人: admin                                                   │
│                                                                 │
│ [达标类]  [评估对象: 区县]  指标数: 30                          │
│                                                                 │
│ 根据国家义务教育优质均衡发展督导评估办法制定，用于评估区县级    │
│ 义务教育优质均衡发展水平，包括资源配置、政府保障程度、教育质量  │
│ 等维度。                                                        │
│                                                                 │
│ 附件 (0)                                                        │
│ ┌─────────────────────────────────────────────────────────────┐│
│ │                        📁 暂无附件                          ││
│ └─────────────────────────────────────────────────────────────┘│
│                                                                 │
│                                        [关闭]    [✏️ 编辑]     │
└─────────────────────────────────────────────────────────────────┘
```

**展示信息：**
| 位置 | 信息 | 说明 |
|------|------|------|
| 标题栏 | 名称 | 指标体系名称 |
| 标题栏右侧 | 状态 | 草稿/编辑中/已发布，带颜色标识 |
| 信息行 | 创建时间、创建人 | 首次创建的时间和用户 |
| 信息行 | 更新时间、更新人 | 最后更新的时间和用户 |
| 标签区 | 类型标签 | 达标类（绿色）/ 评分类（蓝色） |
| 标签区 | 评估对象 | 如"评估对象: 区县"（青色） |
| 标签区 | 指标数 | 该体系下的指标总数 |
| 正文区 | 描述 | 指标体系的详细描述 |
| 附件区 | 附件列表 | 显示附件数量，可下载；无附件时显示"暂无附件" |

**底部按钮：**
| 按钮 | 功能 |
|------|------|
| 关闭 | 关闭弹窗 |
| 编辑 | 打开编辑表单，可修改基础信息 |

**主流程：**
1. 在列表点击"基础信息"按钮
2. 弹出详情弹窗，展示指标体系信息
3. 查看名称、状态、创建/更新信息、标签、描述
4. 查看附件列表（如有附件可点击下载）
5. 点击"关闭"关闭弹窗，或点击"编辑"进入编辑模式

---

### UC-IND-08: 删除指标体系

| 项目 | 内容 |
|------|------|
| 用例编号 | UC-IND-08 |
| 用例名称 | 删除指标体系 |
| 用例简述 | 删除草稿状态的指标体系及其关联数据（指标节点、数据指标、佐证材料、附件），基于拷贝机制不影响已创建项目 |
| 参与者 | 系统管理员 |
| 前置条件 | 指标体系状态为"草稿" |
| 后置条件 | 指标体系及关联数据从系统中移除 |

**设计说明：**
> **指标体系采用拷贝机制**：项目创建时会完整拷贝所选指标体系的快照，与原始指标体系解耦。因此删除原始指标体系**不会影响任何已创建项目的数据**，已创建的项目仍保留完整的指标体系副本。

**删除校验：**
| 校验项 | 规则 | 错误提示 |
|--------|------|----------|
| 状态检查 | 必须为"草稿"状态 | "仅草稿状态的指标体系可删除，请先取消发布" |

**影响范围：**
| 影响对象 | 是否受影响 | 说明 |
|----------|:----------:|------|
| 已创建项目 | ✗ | 项目持有指标体系的独立拷贝，不受原体系删除影响 |
| 新建项目 | ✓ | 删除后，新项目无法选择该指标体系 |

**级联删除范围：**
- 所有层级的指标节点
- 所有数据指标配置
- 所有佐证材料配置
- 关联的附件文件

**主流程：**
1. 点击"删除"按钮
2. 系统校验状态（必须为草稿）
3. 弹出确认对话框，提示删除范围
4. 输入指标体系名称确认（防误删）
5. 点击"确认删除"
6. 系统执行级联删除
7. 刷新列表

**异常流程：**
| 异常 | 处理方式 |
|------|----------|
| 非草稿状态 | 按钮禁用或隐藏，Tooltip提示"请先取消发布" |
| 确认名称不匹配 | 提示"输入的名称不正确"，阻止删除 |

---

## 附录

### 指标属性说明

| 属性 | 说明 |
|------|------|
| 编码 (code) | 指标唯一标识，自动生成（如：A、A1、A1.1） |
| 名称 (name) | 指标显示名称 |
| 层级 (level) | 指标层级（1-3） |
| 权重 (weight) | 指标权重（评分类体系使用） |
| 是否叶子节点 | 标识是否为叶子节点（无子指标），叶子节点可配置数据指标和佐证材料 |
| 数据指标 | 关联的量化数据指标列表（仅叶子节点） |
| 佐证材料 | 需要提交的证明材料列表（仅叶子节点） |

### 数据指标属性

| 属性 | 说明 |
|------|------|
| 编码 (code) | 数据指标唯一标识，如 1.1-D1 |
| 适用范围 (targetType) | 适用的学校类型（全部/幼儿园/小学/初中等） |
| 名称 (name) | 数据指标名称 |
| 达标阈值类型 (thresholdType) | single（单值比较）、range（区间） |
| 精确位数 (precision) | 数值精度（整数/1位/2位/3位） |
| 比较运算符 | 单值比较时使用（=/>=/<=/>/<） |
| 阈值 (threshold) | 达标阈值（如：>= 5%、<= 0.50） |
| 说明 (description) | 计算公式或详细说明 |

### 佐证材料属性

| 属性 | 说明 |
|------|------|
| 编码 (code) | 材料唯一标识，如 1.1-M1 |
| 适用范围 (targetType) | 适用的学校类型（全部/幼儿园/小学/初中等） |
| 名称 (name) | 材料名称 |
| 最大文件大小 (maxSize) | 单文件大小限制（MB） |
| 文件类型 (fileTypes) | 允许上传的文件格式（PDF/Word/Excel/JPG/PNG） |
| 是否必填 (required) | 是否为必须上传的材料 |
| 说明 (description) | 材料要求说明 |

### 与其他模块关系

- 指标体系 ←→ 项目配置：项目关联指标体系作为评估标准
- 数据指标 ←→ 要素：数据指标引用要素获取实际数据值
- 佐证材料 ←→ 要素：佐证材料关联文件类型要素，通过要素映射到采集工具的文件上传字段

### 数据指标与佐证材料的数据流

```
┌─────────────┐      ┌─────────────┐      ┌─────────────┐      ┌─────────────┐
│  数据指标   │ ───→ │    要素     │ ───→ │ 采集工具字段 │ ───→ │  数据填报   │
│ (阈值定义)  │      │ (数据存储)  │      │ (表单控件)  │      │ (数据采集)  │
└─────────────┘      └─────────────┘      └─────────────┘      └─────────────┘
                           ↑
┌─────────────┐            │
│  佐证材料   │ ───────────┘
│ (材料要求)  │      关联文件类型要素
└─────────────┘
```
