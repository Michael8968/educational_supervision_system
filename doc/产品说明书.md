# 教育督导评估系统 - 产品说明书

## 一、产品概述

### 1.1 系统名称
沈阳市教育督导系统 (Educational Supervision System)

### 1.2 系统定位
教育督导评估系统是一个综合性的教育督导管理平台，用于管理和执行沈阳市各类教育督导评估项目。

### 1.3 支持的督导类型
| 督导类型 | 状态 | 说明 |
|----------|------|------|
| 义务教育优质均衡督导 | 已上线 | 义务教育阶段学校资源配置均衡评估 |
| 幼儿园普惠督导 | 已上线 | 幼儿园普惠性办学评估 |
| 教育专项督导 | 开发中 | 针对特定教育事项的专项督导 |
| 挂牌督导 | 开发中 | 责任督学挂牌督导工作 |

### 1.4 核心目标
- 集中管理指标体系、要素库和数据采集工具
- 标准化学校和区县数据采集流程
- 综合达标评估与统计报告
- 资源配置均衡性分析
- 专家评审与决策支持

---

## 二、技术架构

### 2.1 技术栈

| 层级 | 技术选型 | 版本 |
|------|----------|------|
| **前端框架** | React + TypeScript | 19.2.1 / 4.9.5 |
| **UI 组件库** | Ant Design | 6.1.0 |
| **路由管理** | React Router DOM | 7.10.1 |
| **状态管理** | Zustand | 5.0.9 |
| **后端框架** | Express (Node.js) | 5.2.1 |
| **数据库** | Supabase (PostgreSQL) | - |
| **测试框架** | Jest + React Testing Library | 30.2.0 |

### 2.2 部署架构

```
┌─────────────┐    ┌─────────────┐    ┌─────────────┐
│   Vercel    │───►│  Railway    │───►│  Supabase   │
│  (前端)     │    │  (后端)     │    │  (数据库)   │
└─────────────┘    └─────────────┘    └─────────────┘
```

---

## 三、用户角色与权限

### 3.1 角色定义

| 角色 | 代码 | 权限 | 功能范围 |
|------|------|------|----------|
| 系统管理员 | admin | canManageSystem | 全系统管理，区县、学校配置 |
| 市级管理员 | city_admin | - | 市级项目管理，全局数据查看 |
| 区县管理员 | district_admin | canManageProjects | 区县级督导管理，辖区学校数据 |
| 学校填报员 | school_reporter | canCollectData | 学校数据填报与提交 |
| 数据采集员 | collector | canCollectData | 执行数据采集任务 |
| 项目管理员 | project_manager | canManageProjects | 项目创建与配置 |
| 评估专家 | expert | canReviewData | 数据审核与评估 |
| 报告决策者 | decision_maker | canViewReports | 查看统计报告 |

### 3.2 功能入口

| 角色 | 主页面 | 主要功能 |
|------|--------|----------|
| 系统管理员 | /home/system | 区县管理、学校管理、用户管理 |
| 区县管理员 | /district | 指标汇总、学校指标、提交详情 |
| 数据采集员 | /collector | 任务列表、数据填报、合规查看 |
| 评估专家 | /expert | 待审列表、审核操作、统计概览 |

---

## 四、核心功能模块

### 4.1 指标体系管理

#### 功能描述
构建和管理三级树形结构的评估指标体系，支持达标类和评分类两种评估模式。

#### 数据结构

```
指标体系 (IndicatorSystem)
├── 一级指标 (level=1)
│   └── 二级指标 (level=2)
│       └── 三级指标 (level=3, is_leaf=1)
│           ├── 数据指标 (DataIndicator) ← 量化采集项
│           └── 佐证资料 (SupportingMaterial) ← 证明材料
```

#### 核心功能
- 创建/发布指标体系
- 定义多级指标层次
- 配置数据指标（阈值、计算方法）
- 设置佐证资料要求
- 状态管理（草稿/已发布/编辑中）

#### 相关页面
- 指标库列表：`/home/balanced/indicators`
- 指标编辑：`/home/balanced/indicators/:id/edit`
- 指标树编辑：`/home/balanced/indicators/:id/tree`

---

### 4.2 要素库管理

#### 功能描述
管理可复用的数据要素定义，支持基础要素（直接采集）和派生要素（公式计算）。

#### 要素类型

| 类型 | 说明 | 示例 |
|------|------|------|
| 基础要素 | 直接从表单采集的原始数据 | 学生数、教师数、教学面积 |
| 派生要素 | 通过公式计算得出 | 生师比 = 学生数 / 教师数 |

#### 要素属性
- 代码、名称、描述
- 数据类型（文本/数字/日期/选择/数组/文件）
- 关联工具和字段 (toolId, fieldId)
- 计算公式（派生要素）
- 聚合配置（多份提交数据汇总）

#### 聚合方法
`sum` | `avg` | `count` | `max` | `min` | `median` | `stddev` | `range` | `cv`

#### 相关页面
- 要素库列表：`/home/balanced/elements`
- 要素编辑：`/home/balanced/elements/:id/edit`

---

### 4.3 采集工具管理

#### 功能描述
设计和管理数据采集表单/问卷，基于 JSON Schema 定义表单结构。

#### 工具类型
- **表单**：结构化数据采集模板
- **问卷**：问答式数据采集

#### 支持的字段类型

| 类别 | 字段类型 |
|------|----------|
| 输入类 | text, textarea, number |
| 选择类 | radio, checkbox, select, multi-select |
| 时间类 | date, time |
| 文件类 | file |
| 复合类 | group, dynamicList |

#### 表单特性
- JSON 格式 Schema 定义
- 字段级验证规则
- 条件显示逻辑
- 字段与要素/指标映射
- 状态管理（草稿/已发布/编辑中）

#### 相关页面
- 工具库列表：`/home/balanced/tools`
- 工具编辑：`/home/balanced/tools/:id/edit`

---

### 4.4 项目管理

#### 项目生命周期

```
配置中 ──► 填报中 ──► 评审中 ──► 已完成
   │          │          │
   └──────────┴──────────┴──► 已中止
```

| 状态 | 说明 |
|------|------|
| 配置中 | 项目设置和配置阶段 |
| 填报中 | 数据采集进行中 |
| 评审中 | 专家审核阶段 |
| 已完成 | 项目结束 |
| 已中止 | 项目终止 |

#### 项目配置内容

1. **基本信息**：名称、时间、关键词、关联指标体系
2. **人员管理**：负责人、成员、专家、观察员
3. **样本配置**：区县、学校、年级、班级、学生、教师
4. **工具关联**：选择采集工具，配置字段映射
5. **任务分配**：创建并分配数据采集任务

#### 相关页面
- 项目列表：`/home/balanced`
- 项目配置：`/home/balanced/project/:projectId/config`

---

### 4.5 数据填报与审核

#### 填报状态流转

```
草稿 ──► 已提交 ──► 已通过
              │
              └──► 已退回 ──► 已提交 (重新提交)
```

#### 填报记录内容
- 项目ID、学校ID、工具ID
- 填报人信息（姓名、单位）
- 表单数据（JSON 格式）
- 佐证资料附件
- 审核信息（审核人、审核时间、审核意见）

#### 专家审核功能
- 查看待审列表
- 审核通过/退回
- 填写审核意见
- 批量操作支持

#### 相关页面
- 数据填报：`/home/balanced/entry`
- 表单填写：`/home/balanced/entry/:projectId/form/:formId`
- 专家审核：`/expert`

---

### 4.6 统计与报告

#### 统计功能

| 功能 | 说明 |
|------|------|
| CV 分析 | 变异系数分析，评估资源均衡性 |
| 资源指标汇总 | 7 项资源配置指标统计 |
| 区县对比 | 区县间指标对比排名 |
| 达标统计 | 各类别达标率统计 |
| 学校指标 | 学校级别指标详情 |

#### 相关页面
- CV 分析：`/home/balanced/project/:projectId/cv-analysis`
- 达标统计：`/home/balanced/project/:projectId/compliance`
- 区县仪表盘：`/district`

---

### 4.7 资源配置指标与综合达标

#### 七项资源配置指标

| 代码 | 指标名称 | 小学标准 | 初中标准 | 单位 |
|------|----------|----------|----------|------|
| L1 | 每百名学生拥有高学历教师数 | ≥4.2 | ≥5.3 | 人 |
| L2 | 每百名学生拥有骨干教师数 | ≥1.0 | ≥1.1 | 人 |
| L3 | 每百名学生拥有体艺教师数 | ≥0.9 | ≥1.0 | 人 |
| L4 | 生均教学及辅助用房面积 | ≥4.5 | ≥5.8 | ㎡ |
| L5 | 生均体育运动场馆面积 | ≥7.5 | ≥8.4 | ㎡ |
| L6 | 生均教学仪器设备值 | ≥2000 | ≥2500 | 元 |
| L7 | 每百名学生拥有多媒体教室数 | ≥2.3 | ≥2.4 | 间 |

#### 综合达标规则

```javascript
OVERALL_COMPLIANCE_CONFIG = {
  minCompliantCount: 6,        // 至少6项达标
  minThresholdPercent: 0.85,   // 未达标项不低于标准的85%
  description: '每所学校至少6项指标达标，余项不低于标准的85%'
}
```

#### 变异系数 (CV) 分析

用于评估区域内学校间资源配置均衡程度：

```
CV = 标准差 / 平均值

达标阈值：
- 小学：CV ≤ 0.50
- 初中：CV ≤ 0.45
```

#### 一体化学校处理

| 学校类型 | 分段评估 |
|----------|----------|
| 九年一贯制学校 | 小学部 + 初中部 |
| 完全中学 | 初中部 + 高中部 |

---

## 五、数据库设计

### 5.1 核心实体表

| 表名 | 说明 | 主要字段 |
|------|------|----------|
| districts | 区县 | id, code, name, type, parent_code |
| schools | 学校 | id, code, name, district_id, school_type, student_count |
| indicator_systems | 指标体系 | id, name, type, target, status |
| indicators | 指标 | id, system_id, parent_id, code, name, level, is_leaf |
| data_indicators | 数据指标 | id, indicator_id, code, name, threshold, data_type |
| element_libraries | 要素库 | id, name, description, status |
| elements | 要素 | id, library_id, code, name, element_type, formula |
| data_tools | 采集工具 | id, name, type, schema, status |
| projects | 项目 | id, name, indicator_system_id, status, start_date, end_date |

### 5.2 项目配置表

| 表名 | 说明 |
|------|------|
| project_personnel | 项目人员 |
| project_sample_config | 样本配置 |
| project_samples | 项目样本 |
| project_tools | 项目工具关联 |
| field_mappings | 字段映射 |
| tasks | 任务 |

### 5.3 数据采集表

| 表名 | 说明 |
|------|------|
| submissions | 填报记录 |
| submission_materials | 填报佐证资料 |
| supporting_materials | 佐证资料配置 |

### 5.4 统计分析表

| 表名 | 说明 |
|------|------|
| school_indicator_data | 学校指标数据 |
| district_statistics | 区县统计快照 |
| compliance_rules | 合规规则 |
| compliance_results | 合规检查结果 |

### 5.5 实体关系图

```
indicator_systems (1) ──┬──< indicators (N)
                       │      └──< data_indicators (N)
                       │      └──< supporting_materials (N)
                       │
projects (1) ──────────┴── indicator_system_id
     │
     └──< project_tools >──< data_tools (N)
                                  │
                                  └──< field_mappings (N)
                                           │
                                           ├── data_indicators
                                           └── elements

submissions (N) ──┬── project_id → projects
                 ├── form_id → data_tools
                 └──< submission_materials (N)

element_libraries (1) ──< elements (N)
```

---

## 六、API 接口

### 6.1 认证接口
| 方法 | 路径 | 说明 |
|------|------|------|
| POST | /api/login | 用户登录 |
| GET | /api/health | 健康检查 |

### 6.2 指标管理接口
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/indicator-systems | 指标体系列表 |
| GET | /api/indicator-systems/:id | 指标体系详情 |
| GET | /api/indicator-systems/:id/tree | 指标树 |
| POST | /api/indicator-systems | 创建指标体系 |
| PUT | /api/indicator-systems/:id | 更新指标体系 |
| DELETE | /api/indicator-systems/:id | 删除指标体系 |
| POST | /api/data-indicators | 创建数据指标 |

### 6.3 要素工具接口
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/element-libraries | 要素库列表 |
| POST | /api/element-libraries | 创建要素库 |
| GET | /api/tools | 工具列表 |
| GET | /api/tools/:id | 工具详情 |
| POST | /api/tools | 创建工具 |
| PUT | /api/tools/:id | 更新工具 |

### 6.4 项目管理接口
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/projects | 项目列表 |
| GET | /api/projects/:id | 项目详情 |
| POST | /api/projects | 创建项目 |
| PUT | /api/projects/:id | 更新项目 |
| POST | /api/projects/:id/start | 启动项目 |
| POST | /api/projects/:id/stop | 停止项目 |
| POST | /api/projects/:id/review | 进入评审 |

### 6.5 数据提交接口
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/submissions | 提交列表 |
| GET | /api/submissions/:id | 提交详情 |
| POST | /api/submissions | 创建提交 |
| PUT | /api/submissions/:id | 更新提交 |
| POST | /api/submissions/:id/approve | 审核通过 |
| POST | /api/submissions/:id/reject | 审核退回 |

### 6.6 统计接口
| 方法 | 路径 | 说明 |
|------|------|------|
| GET | /api/statistics/districts/:districtId/resource-indicators-summary | 资源指标汇总 |
| GET | /api/projects/:projectId/cv-analysis | CV 分析 |
| GET | /api/projects/:projectId/cv-summary | CV 汇总 |
| GET | /api/districts/:districtId/schools-indicators | 学校指标 |

---

## 七、业务流程

### 7.1 项目配置流程

```
创建项目 → 关联指标体系 → 配置人员 → 配置样本 → 关联工具 → 配置映射 → 分配任务 → 启动项目
```

### 7.2 数据采集流程

```
采集员接收任务 → 打开表单 → 填写数据 → 上传佐证 → 提交审核 → 等待结果
                                                         ↓
                                              退回 ← 专家审核 → 通过
                                                ↓
                                            修改重提
```

### 7.3 评估分析流程

```
数据汇总 → 指标计算 → 阈值比对 → 达标判定 → CV分析 → 生成报告
```

---

## 八、页面导航结构

### 8.1 主页面 (/)
- 项目模块选择
- 角色入口

### 8.2 项目管理模块 (/home/balanced)
- 项目列表
- 要素库 (/elements)
- 工具库 (/tools)
- 指标库 (/indicators)
- 数据填报 (/entry)
- 项目配置 (/project/:id/config)
- CV分析 (/project/:id/cv-analysis)
- 达标统计 (/project/:id/compliance)

### 8.3 系统管理 (/home/system)
- 区县管理 (/districts)
- 学校管理 (/schools)

### 8.4 用户管理 (/users)
- 学校账户管理 (/school-account)
- 专家账户管理 (/expert-account)

### 8.5 角色工作台
- 区县管理员：/district
- 数据采集员：/collector
- 评估专家：/expert

---

## 九、技术特性

### 9.1 数据验证
- 字段级验证（必填、类型、范围）
- 表单级验证（跨字段依赖）
- 合规规则引擎（条件、逻辑运算）

### 9.2 公式计算
- 数学表达式支持：`+`, `-`, `*`, `/`, `()`
- 变量引用：要素代码（E001, E002）
- 空值安全处理

### 9.3 性能优化
- 列支持缓存（5分钟TTL）
- 数据库索引优化
- 分页查询支持

### 9.4 安全特性
- Token 认证
- 角色权限控制 (RBAC)
- 路由级保护
- 输入验证与 SQL 注入防护

---

## 十、版本信息

| 项目 | 版本 | 说明 |
|------|------|------|
| 前端 | 1.0.0 | React 19 + Ant Design 6 |
| 后端 | 1.0.0 | Express 5 + Supabase |
| 文档 | 2025-01 | 产品说明书 |

---

## 附录

### A. 相关文档
- [评估指标、评估要素与采集表单关系分析](./评估指标、评估要素与采集表单关系分析.md)
- [项目-指标-要素-工具关系与数据流](./项目-指标-要素-工具关系与数据流.md)
- [UI设计规范](./UI设计规范.md)
- [增强方案-支持义务教育优质均衡评估](./增强方案-支持义务教育优质均衡评估.md)

### B. 测试账户（开发环境）
| 角色 | 用户名 | 密码 |
|------|--------|------|
| 系统管理员 | AAA | BBB |
| 项目管理员 | 111 | 222 |
| 数据采集员 | 333 | 444 |
| 评估专家 | 555 | 666 |
| 报告决策者 | 777 | 888 |
