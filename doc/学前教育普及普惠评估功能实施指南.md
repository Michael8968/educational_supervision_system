# 学前教育普及普惠督导评估功能实施指南

## 一、功能概述

本指南介绍如何在现有教育督导评估系统基础上实施学前教育普及普惠督导评估功能。该功能与义务教育优质均衡评估并行运行，作为独立的评估项目。

### 核心特性

1. **独立的评估体系**：学前教育评估作为独立项目，有自己的指标体系、数据采集和统计分析
2. **区县和幼儿园双层级评估**：支持区县层面和单个幼儿园的评估
3. **达标类评估**：基于17项一级指标、36项二级指标进行达标评估
4. **分级达标判定**：支持巩固/提高/创优三个等级的"学前双普"判定
5. **幼儿园管理**：扩展学校管理功能支持幼儿园类型

## 二、系统架构

### 2.1 数据库扩展

#### 扩展内容
- `schools` 表新增幼儿园相关字段
- 新增幼儿园类型枚举
- 新增学前教育统计视图和计算函数

#### 实施步骤

**步骤1：执行数据库迁移脚本**

```bash
cd backend/database
sqlite3 database.db < add-preschool-support.sql
```

**步骤2：验证扩展**

```sql
-- 检查 schools 表新增字段
PRAGMA table_info(schools);

-- 检查视图是否创建成功
SELECT * FROM v_district_preschool_summary;

-- 检查函数是否可用
SELECT calc_public_kindergarten_ratio('your-district-id');
```

### 2.2 后端API

#### 新增路由
- `/api/preschool-statistics/districts/:districtId/universalization-summary` - 普及普惠水平指标汇总
- `/api/preschool-statistics/districts/:districtId/overall-compliance` - 综合达标情况
- `/api/preschool-statistics/projects/:projectId/kindergarten-summary` - 幼儿园统计汇总

#### 关键配置

**文件位置**：`backend/routes/preschool-statistics.js`

**达标标准配置**：
```javascript
const PRESCHOOL_COMPLIANCE_CONFIG = {
  totalIndicators: 36,
  levels: {
    consolidated: {  // 巩固
      minCompliant: 29,
      maxBasicCompliant: 7
    },
    improved: {  // 提高
      minCompliant: 31,
      maxBasicCompliant: 5
    },
    excellence: {  // 创优
      minCompliant: 33,
      maxBasicCompliant: 3
    }
  }
};
```

### 2.3 前端组件

#### 新增服务
- `frontend/src/services/preschoolStatisticsService.ts` - 统计服务

#### 新增页面
- `frontend/src/pages/PreschoolDashboard/index.tsx` - 学前教育工作台

#### 页面功能
1. **Tab 1：普及普惠水平** - 展示3项核心指标及达标情况
2. **Tab 2：综合达标情况** - 展示全部36项指标的达标情况和等级判定
3. **Tab 3：幼儿园统计** - 展示幼儿园汇总数据和明细列表

## 三、实施步骤

### 步骤1：数据库准备

1. **备份现有数据库**
   ```bash
   cp backend/database.db backend/database.db.backup
   ```

2. **执行数据库扩展脚本**
   ```bash
   cd backend/database
   sqlite3 database.db < add-preschool-support.sql
   ```

3. **更新枚举定义**

   枚举已在 `backend/constants/enums.js` 中更新：
   - `SCHOOL_TYPE` 新增 `'幼儿园'`
   - `KINDERGARTEN_TYPE`: `['公办', '普惠性民办', '非普惠性民办']`
   - `KINDERGARTEN_LEVEL`: `['省级示范', '市级示范', '一类', '二类', '三类', '未定级']`
   - `COMMUNITY_HANDOVER_STATUS`: `['已移交', '未移交', '不适用']`

### 步骤2：导入学前教育指标体系

1. **确认指标体系文件**

   文件位置：`doc/数据/学前教育普及普惠督导评估指标体系.json`

2. **运行导入脚本**
   ```bash
   cd backend
   node scripts/import-preschool-indicators.js
   ```

3. **验证导入结果**

   脚本会输出：
   - 指标体系ID
   - 指标总数
   - 数据指标数
   - 佐证资料数

### 步骤3：创建学前教育评估项目

1. **登录系统**（使用系统管理员或市级管理员账号）

2. **创建项目**
   - 进入"项目管理"页面
   - 点击"新建项目"
   - 填写项目信息：
     - 项目名称：如"2024年沈阳市学前教育普及普惠督导评估"
     - 评估类型：学前教育
     - 选择区县：选择参与评估的区县

3. **关联指标体系**
   - 在项目配置中，选择"指标体系"选项卡
   - 关联刚导入的学前教育指标体系

4. **配置采集工具**
   - 选择"数据填报"选项卡
   - 导入或创建数据采集表单
   - 参考文件：`doc/数据/学前教育普及普惠督导评估采集表单.json`

5. **配置字段映射**
   - 在表单编辑器中，配置字段到数据指标的映射关系
   - 映射关系已在表单JSON中定义

6. **分派任务**
   - 选择"任务分派"选项卡
   - 为各区县分派填报任务
   - 设置填报截止时间

### 步骤4：导入幼儿园数据

**方式一：手动录入**

1. 进入"学校管理"页面
2. 点击"新建学校"
3. 选择学校类型为"幼儿园"
4. 填写幼儿园信息：
   - 基本信息：代码、名称、地址、联系方式
   - 类型信息：公办/普惠性民办/非普惠性民办
   - 统计数据：在园幼儿数、教师数、班级数等
   - 场地信息：占地面积、户外活动场地面积等

**方式二：批量导入**

1. 准备Excel数据文件，包含以下列：
   - 幼儿园代码
   - 幼儿园名称
   - 所属区县
   - 幼儿园类型（公办/普惠性民办/非普惠性民办）
   - 幼儿园等级
   - 在园幼儿数
   - 教师数
   - 班级数
   - 城乡类型
   - 是否为小区配套幼儿园
   - 移交状态

2. 使用数据导入工具批量导入

### 步骤5：区县填报数据

1. **区县登录系统**
   - 使用区县管理员或填报员账号登录

2. **查看待填报任务**
   - 进入"我的任务"页面
   - 找到学前教育评估填报任务

3. **填报数据**
   - 点击"开始填报"
   - 按表单要求填写各项数据
   - 计算字段会自动计算（如毛入园率、覆盖率等）

4. **上传佐证材料**
   - 对于需要佐证材料的指标（如党的领导、发展规划等）
   - 上传相关文件（PDF、Word、图片等）

5. **提交填报**
   - 检查数据完整性
   - 提交填报

### 步骤6：查看评估结果

**区县查看**

1. 进入"学前教育工作台"页面
2. 查看三个选项卡的内容：
   - **普及普惠水平**：查看3项核心指标达标情况
   - **综合达标情况**：查看全部指标达标情况和等级判定
   - **幼儿园统计**：查看幼儿园汇总数据

**市级查看**

1. 进入"项目管理"
2. 选择学前教育评估项目
3. 查看各区县的评估结果和汇总统计

## 四、API使用说明

### 4.1 普及普惠水平指标汇总

**接口**：`GET /api/preschool-statistics/districts/:districtId/universalization-summary`

**参数**：
- `districtId`: 区县ID（路径参数）
- `projectId`: 项目ID（查询参数）

**响应示例**：
```json
{
  "district": {
    "id": "district-001",
    "code": "210100",
    "name": "和平区"
  },
  "indicators": [
    {
      "code": "1.1-D1",
      "name": "学前三年毛入园率",
      "value": 92.5,
      "unit": "%",
      "threshold": 85,
      "operator": ">=",
      "complianceLevel": "compliant",
      "isCompliant": true
    }
  ],
  "summary": {
    "totalCount": 3,
    "compliantCount": 3,
    "basicCount": 0,
    "nonCompliantCount": 0,
    "pendingCount": 0,
    "allCompliant": true
  }
}
```

### 4.2 综合达标情况

**接口**：`GET /api/preschool-statistics/districts/:districtId/overall-compliance`

**响应示例**：
```json
{
  "district": { ... },
  "indicators": [
    {
      "code": "1.1",
      "name": "学前三年毛入园率达到85%以上",
      "complianceLevel": "compliant"
    }
  ],
  "summary": {
    "totalCount": 36,
    "compliantCount": 33,
    "basicCount": 3,
    "nonCompliantCount": 0,
    "pendingCount": 0
  },
  "complianceLevel": {
    "level": "excellence",
    "name": "创优\"学前双普\"",
    "description": "33项合格 + 3项基本合格，达到创优标准"
  }
}
```

### 4.3 幼儿园统计汇总

**接口**：`GET /api/preschool-statistics/projects/:projectId/kindergarten-summary`

**响应示例**：
```json
{
  "project": {
    "id": "project-001",
    "name": "2024年学前教育普及普惠督导评估"
  },
  "kindergartens": [...],
  "summary": {
    "total": 120,
    "byType": {
      "public": 60,
      "inclusivePrivate": 45,
      "nonInclusivePrivate": 15
    },
    "students": {
      "total": 15000,
      "public": 8000,
      "inclusivePrivate": 5500,
      "publicRatio": "53.33",
      "inclusiveCoverage": "90.00"
    }
  }
}
```

## 五、关键文件清单

### 后端文件

| 文件路径 | 说明 |
|---------|------|
| `backend/database/add-preschool-support.sql` | 数据库扩展脚本 |
| `backend/constants/enums.js` | 枚举定义（已更新） |
| `backend/routes/preschool-statistics.js` | 学前教育统计API |
| `backend/scripts/import-preschool-indicators.js` | 指标体系导入脚本 |
| `backend/app.js` | 应用入口（已注册新路由） |

### 前端文件

| 文件路径 | 说明 |
|---------|------|
| `frontend/src/services/preschoolStatisticsService.ts` | 统计服务 |
| `frontend/src/pages/PreschoolDashboard/index.tsx` | 工作台页面 |

### 数据文件

| 文件路径 | 说明 |
|---------|------|
| `doc/数据/学前教育普及普惠督导评估指标体系.json` | 指标体系定义 |
| `doc/数据/学前教育普及普惠督导评估采集表单.json` | 数据采集表单 |

## 六、常见问题

### Q1: 如何修改达标标准？

**A**: 修改 `backend/routes/preschool-statistics.js` 中的 `PRESCHOOL_COMPLIANCE_CONFIG` 配置。

### Q2: 如何添加新的指标？

**A**:
1. 修改 `doc/数据/学前教育普及普惠督导评估指标体系.json`
2. 重新运行导入脚本
3. 更新采集表单
4. 更新字段映射

### Q3: 学前教育和义务教育评估能同时进行吗？

**A**: 可以。两个评估作为独立项目，互不影响，可以同时进行。

### Q4: 如何查看历史评估数据？

**A**: 在项目列表中选择已完成的项目，可以查看历史评估数据和结果。

### Q5: 支持导出评估报告吗？

**A**: 目前支持数据导出。可以通过统计API获取数据后生成自定义报告。

## 七、技术支持

如有问题或需要技术支持，请联系：
- 技术文档：查看系统文档目录
- 问题反馈：通过系统反馈功能提交
- 紧急支持：联系系统管理员

## 八、附录

### 附录A：达标标准详解

**普及普惠水平（3项，全部达标）**
1. 学前三年毛入园率 ≥ 85%
2. 普惠性幼儿园覆盖率 ≥ 80%
3. 公办园在园幼儿占比 ≥ 50%

**政府保障情况（11项，全部达标）**
- 涵盖党的领导、发展规划、财政投入、收费管理、教师待遇、安全监管等

**保教质量保障（6项，全部达标）**
- 涵盖办园条件、班额、教职工配备、教师管理、科学保教等

**分级达标标准**
- 巩固：29项合格 + 7项基本合格（共36项）
- 提高：31项合格 + 5项基本合格（共36项）
- 创优：33项合格 + 3项基本合格（共36项）

### 附录B：计算公式

1. **学前三年毛入园率** = (在园幼儿总数 ÷ 3-5岁适龄儿童总数) × 100
2. **普惠性幼儿园覆盖率** = ((公办园在园幼儿数 + 普惠性民办园在园幼儿数) ÷ 在园幼儿总数) × 100
3. **公办园在园幼儿占比** = (公办园在园幼儿数 ÷ 在园幼儿总数) × 100

### 附录C：更新日志

| 版本 | 日期 | 更新内容 |
|------|------|---------|
| 1.0.0 | 2024-XX-XX | 初始版本，完成学前教育评估功能基础实现 |

---

**文档版本**：1.0.0
**最后更新**：2024年
**维护者**：教育督导评估系统开发团队
